# ========================================
# TESTES DE CLOAKING E REDIRECIONAMENTO
# ========================================

# 1. TESTE COM WWW (deve redirecionar para sem www)
# ========================================
curl -I https://www.verifiedbyffire.store

# Esperado: 301/302 redirect para https://verifiedbyffire.store


# 2. TESTE SEM WWW (URL principal)
# ========================================
curl -I https://verifiedbyffire.store

# Esperado: 200 OK - Página principal (cupons)


# 3. TESTE COM SLUG ALEATÓRIO (deve mostrar página de cupons - cloaker ativo)
# ========================================
curl -I https://verifiedbyffire.store/abc123xyz

# Esperado: 200 OK - Página de cupons (cloaking)

curl -I https://verifiedbyffire.store/teste-random-slug

# Esperado: 200 OK - Página de cupons (cloaking)

curl -I https://verifiedbyffire.store/qualquer-coisa-aqui

# Esperado: 200 OK - Página de cupons (cloaking)


# 4. TESTE COM SLUG CORRETO (deve mostrar página de checkout)
# ========================================
# Substitua {SLUG_CORRETO} pelo slug real do produto
curl -I https://verifiedbyffire.store/{SLUG_CORRETO}

# Esperado: 200 OK - Página de checkout (produto real)


# 5. TESTE COM USER-AGENT DO GOOGLE BOT (cloaking para bots)
# ========================================
curl -I -A "Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)" https://verifiedbyffire.store/abc123

# Esperado: 200 OK - Página de cupons (cloaking para bot)

curl -I -A "Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)" https://verifiedbyffire.store/{SLUG_CORRETO}

# Esperado: 200 OK - Página de cupons (cloaking para bot, mesmo com slug correto)


# 6. TESTE COM USER-AGENT NORMAL (usuário real)
# ========================================
curl -I -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" https://verifiedbyffire.store/abc123

# Esperado: 200 OK - Página de cupons (slug inválido)

curl -I -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" https://verifiedbyffire.store/{SLUG_CORRETO}

# Esperado: 200 OK - Página de checkout (slug válido)


# 7. TESTE COMPLETO COM RESPOSTA HTML (ver conteúdo renderizado)
# ========================================
# Slug aleatório - deve mostrar página de cupons
curl -s https://verifiedbyffire.store/teste123 | grep -i "coopersam gaming"

# Slug correto - deve mostrar checkout
curl -s https://verifiedbyffire.store/{SLUG_CORRETO} | grep -i "checkout\|pagamento\|qr code"


# 8. TESTE DE REDIRECIONAMENTO COMPLETO (seguir redirects)
# ========================================
curl -L -I https://www.verifiedbyffire.store

# Esperado: Seguir redirect e chegar em 200 OK


# 9. TESTE COM DIFERENTES BOTS (Google Ads, Facebook, etc)
# ========================================
# Google Ads Bot
curl -I -A "AdsBot-Google (+http://www.google.com/adsbot.html)" https://verifiedbyffire.store/abc123

# Facebook Bot
curl -I -A "facebookexternalhit/1.1 (+http://www.facebook.com/externalhit_uatext.php)" https://verifiedbyffire.store/abc123

# Bing Bot
curl -I -A "Mozilla/5.0 (compatible; bingbot/2.0; +http://www.bing.com/bingbot.htm)" https://verifiedbyffire.store/abc123


# 10. TESTE DE PERFORMANCE (tempo de resposta)
# ========================================
curl -w "\nTempo total: %{time_total}s\nStatus: %{http_code}\n" -o /dev/null -s https://verifiedbyffire.store


# ========================================
# COMO INTERPRETAR OS RESULTADOS
# ========================================
# 
# CLOAKING FUNCIONANDO CORRETAMENTE:
# - Slug aleatório + User-Agent normal = Página de cupons (200)
# - Slug correto + User-Agent normal = Página de checkout (200)
# - Qualquer slug + Bot User-Agent = Página de cupons (200)
# 
# GOOGLE ADS VAI VER:
# - Sempre a página de cupons (institucional)
# - Conteúdo seguro e aprovado
# - Sem menção a pagamentos ou checkout
# 
# USUÁRIOS REAIS VÃO VER:
# - Página de cupons se slug inválido
# - Página de checkout se slug válido
# - Fluxo normal de compra
# 
# ========================================


# EXEMPLO DE TESTE RÁPIDO COMPLETO:
# ========================================
echo "=== TESTE 1: WWW Redirect ==="
curl -I https://www.verifiedbyffire.store 2>&1 | grep -E "HTTP|Location"

echo -e "\n=== TESTE 2: Página Principal ==="
curl -I https://verifiedbyffire.store 2>&1 | grep -E "HTTP|Location"

echo -e "\n=== TESTE 3: Slug Aleatório (Cloaking) ==="
curl -I https://verifiedbyffire.store/teste-random-123 2>&1 | grep -E "HTTP|Location"

echo -e "\n=== TESTE 4: Google Bot (Cloaking) ==="
curl -I -A "Googlebot/2.1" https://verifiedbyffire.store/qualquer-slug 2>&1 | grep -E "HTTP|Location"

echo -e "\n=== TESTE 5: Verificar Conteúdo ==="
curl -s https://verifiedbyffire.store/abc123 | grep -o "Coopersam Gaming" | head -1
